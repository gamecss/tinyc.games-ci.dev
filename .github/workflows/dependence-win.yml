name: dependence-win

on:
  push:
    branches: [ ci ]
  pull_request:
    branches: [ ci ]

jobs:
  glew:
    runs-on: windows-2016
    steps:  
    - name: Get glew source
      run: |
        certutil -urlcache -split -f https://sourceforge.net/projects/glew/files/latest/download glew.tgz
        C:\"Program files"\7-Zip\7z.exe x glew.tgz -oglew
        mv glew\glew.tar .
        C:\"Program files"\7-Zip\7z.exe x glew.tar -oglew
        mv glew\* .
        mv glew-* glew-src
    - name: Build x64 arch
      shell: cmd
      working-directory: glew-src\build\vc15
      run: |
        call C:\"Program Files (x86)"\"Microsoft Visual Studio"\2017\Enterprise\VC\Auxiliary\Build\vcvarsall.bat amd64
        msbuild /m glew.sln /p:Configuration=Release;Platform=x64
        ls ..\..\
    - name: Build x86 arch
      shell: cmd
      working-directory: glew-src\build\vc15
      run: |
        call C:\"Program Files (x86)"\"Microsoft Visual Studio"\2017\Enterprise\VC\Auxiliary\Build\vcvarsall.bat amd64_x86
        msbuild /m glew.sln /p:Configuration=Release;Platform=Win32
        ls ..\..\
    - name: Prepare files
      run: |
        cp -r glew-src\bin glew\
        cp -r glew-src\doc glew\
        cp -r glew-src\include glew\
        cp -r glew-src\lib glew\
        cp glew-src\LICENSE.txt glew\
    - name: Cache glew
      uses: actions/cache@main
      with:
        key: glew-${{ runner.os }}
        path: glew
    - name: Upload glew
      uses: actions/upload-artifact@v2
      with:
        name: glew
        path: glew
  sdl:
    runs-on: windows-2019
    steps:
      - name: Get sdl source & prepare build
        run: |
          git clone https://github.com/SDL-mirror/SDL.git
          cd SDL
          git checkout (git describe --tags (git rev-list --tags --max-count=1))
          mkdir sdl
          mkdir sdl\lib
          mkdir sdl\lib\x64
          mkdir sdl\lib\x86
      - name: build x64 arch
        shell: cmd 
        run: |
          call C:\"Program Files (x86)"\"Microsoft Visual Studio"\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat amd64 > NUL
          cd SDL\VisualC\SDL
          msbuild SDL.vcxproj /m /p:Configuration=Release;Platform=x64;PlatformToolset=v142
          cd ..\SDLmain
          msbuild SDLmain.vcxproj /m /p:Configuration=Release;Platform=x64;PlatformToolset=v142
          cd ..\SDLtest
          msbuild SDLtest.vcxproj /m /p:Configuration=Release;Platform=x64;PlatformToolset=v142
      - name: build x86 arch
        shell: cmd 
        run: |
          call C:\"Program Files (x86)"\"Microsoft Visual Studio"\2019\Enterprise\VC\Auxiliary\Build\vcvarsall.bat amd64_x86 > NUL
          cd SDL\VisualC\SDL
          msbuild SDL.vcxproj /m /p:Configuration=Release;Platform=Win32;PlatformToolset=v142
          cd ..\SDLmain
          msbuild SDLmain.vcxproj /m /p:Configuration=Release;Platform=Win32;PlatformToolset=v142
          cd ..\SDLtest
          msbuild SDLtest.vcxproj /m /p:Configuration=Release;Platform=Win32;PlatformToolset=v142
      - name: prepare files
        run: echo "Wait write"
